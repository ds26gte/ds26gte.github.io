<!doctype html>
<html lang="en">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
  <script type="module" src="../embed-api.js"></script>
  <script src="../codemirror.js"></script>
  <script src="../runmode.js"></script>
  <script src="../pyret.js"></script>
  <script src="../hilite.js"></script>
  <link rel="stylesheet" type="text/css" href="../codemirror.css" title="default"/>
  <link rel="stylesheet" type="text/css" href="../pyret.css" title="default"/>
  <link rel="stylesheet" type="text/css" href="../styles.css" title="default"/>
  <head>
    <title>data-source</title>
  </head>
  <body>
    <div class="container">
    <root><div><h1 id="data-source" toclevel="1" tocentry="yes">data-source</h1><div><p>Usage:</p><pre class="pyret-highlight">include data-source</pre><pre class="pyret-highlight">import data-source as ...</pre></div><p>The general idea of loading a spreadsheet into a table is straightforward: each cell of the spreadsheet corresponds to a cell of the table.  However, spreadsheet files (such as Google Sheets or .csv files) store their data in a serialized format, and loading the file must convert from that representation back into useful Pyret data types.  Moreover, Pyret tables expect each of their columns to be homogeneous, but there is nothing enforcing that restriction on arbitrary spreadsheet files.</p><p>Accordingly, Pyret exposes a <a href="../trove/data-source.html#CellContent"><span class="pyret-highlight"><tt class="pyretexpr">CellContent</tt></span></a> data type to record what type it thinks each cell contains, and a <a href="../trove/data-source.html#Sanitizer"><span class="pyret-highlight"><tt class="pyretexpr">Sanitizer</tt></span></a> to allow enforcing a uniform type over all values in a column.  These two notions are used by the <a href="trove/gdrive-sheets.html#gdrive-sheets">gdrive-sheets</a> library to convert Google Sheets files into Pyret <a href="../builtin/tables.html#Table"><span class="pyret-highlight"><tt class="pyretexpr">Table</tt></span></a>s.  A similar library could be written to use these two types to load tables from .csv files or other data sources.</p><h2 id="The-CellContent-Type" toclevel="2" tocentry="yes">The CellContent Type</h2><pre class="pyret-display"><span><a name="CellContent"></a></span><span>data <a href="../trove/data-source.html#CellContent">CellContent</a>&lt;A&gt;</span>
<div><tt>   | <span>c-empty</span></tt>
<tt>   | <span><a href="../trove/data-source.html#c-str">c-str</a>(<span>s :: <a href="../trove/globals.html#String">String</a></span>)</span></tt>
<tt>   | <span><a href="../trove/data-source.html#c-num">c-num</a>(<span>n :: <a href="../trove/globals.html#Number">Number</a></span>)</span></tt>
<tt>   | <span><a href="../trove/data-source.html#c-bool">c-bool</a>(<span>b :: <a href="../trove/globals.html#Boolean">Boolean</a></span>)</span></tt>
<tt>   | <span><a href="../trove/data-source.html#c-custom">c-custom</a>(<span>datum :: A</span>)</span></tt></div><tt>end</tt></pre><div class="insetpara nested"><div><p><span><a name="c-empty"></a></span></p><pre class="pyret-display">c-empty :: <span><a href="../trove/data-source.html#CellContent">CellContent</a>&lt;<span>A</span>&gt;</span></pre></div><div><p><span><a name="c-str"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#c-str">c-str</a> :: (<span>n :: <a href="../trove/globals.html#String">String</a></span>) -&gt; <span><a href="../trove/data-source.html#CellContent">CellContent</a>&lt;<span>a</span>&gt;</span></pre><p></p></div><div><p><span><a name="c-num"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#c-num">c-num</a> :: (<span>s :: <a href="../trove/globals.html#Number">Number</a></span>) -&gt; <span><a href="../trove/data-source.html#CellContent">CellContent</a>&lt;<span>a</span>&gt;</span></pre><p></p></div><div><p><span><a name="c-bool"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#c-bool">c-bool</a> :: (<span>b :: <a href="../trove/globals.html#Boolean">Boolean</a></span>) -&gt; <span><a href="../trove/data-source.html#CellContent">CellContent</a>&lt;<span>a</span>&gt;</span></pre><p></p></div><div><p><span><a name="c-custom"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#c-custom">c-custom</a> :: (<span>datum :: A</span>) -&gt; <span><a href="../trove/data-source.html#CellContent">CellContent</a>&lt;<span>A</span>&gt;</span></pre><p></p></div><p>  </p><div><p><span><a name="is-c-empty"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#is-c-empty">is-c-empty</a> :: <span>(<span><span class="pyret-content">val :: Any</span></span>) -&gt; <a href="../trove/globals.html#Boolean">Boolean</a></span></pre></div><p>  </p><div><p><span><a name="is-c-str"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#is-c-str">is-c-str</a> :: <span>(<span><span class="pyret-content">val :: Any</span></span>) -&gt; <a href="../trove/globals.html#Boolean">Boolean</a></span></pre></div><p>  </p><div><p><span><a name="is-c-num"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#is-c-num">is-c-num</a> :: <span>(<span><span class="pyret-content">val :: Any</span></span>) -&gt; <a href="../trove/globals.html#Boolean">Boolean</a></span></pre></div><p>  </p><div><p><span><a name="is-c-bool"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#is-c-bool">is-c-bool</a> :: <span>(<span><span class="pyret-content">val :: Any</span></span>) -&gt; <a href="../trove/globals.html#Boolean">Boolean</a></span></pre></div><p>  </p><div><p><span><a name="is-c-custom"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#is-c-custom">is-c-custom</a> :: <span>(<span><span class="pyret-content">val :: Any</span></span>) -&gt; <a href="../trove/globals.html#Boolean">Boolean</a></span></pre></div><p>This datatype describes Pyret’s</p></div><h2 id="Sanitizers" toclevel="2" tocentry="yes">Sanitizers</h2><div><p><span><a name="Sanitizer"></a></span></p><pre class="pyret-display"><span><a href="../trove/data-source.html#Sanitizer">Sanitizer</a>&lt;A, B&gt;</span></pre><p>A <span class="pyret-highlight"><tt class="pyretexpr">Sanitizer&lt;A, B&gt;</tt></span> is a function with signature <span class="pyret-highlight"><tt class="pyretexpr">(</tt></span><a href="../trove/data-source.html#CellContent"><span class="pyret-highlight"><tt class="pyretexpr">CellContent</tt></span></a><span class="pyret-highlight"><tt class="pyretexpr">&lt;A&gt;, </tt></span><a href="UnDeFiNeD"></a><span class="pyret-highlight"><tt class="pyretexpr">,</tt></span><a href="UnDeFiNeD"></a><span class="pyret-highlight"><tt class="pyretexpr"> -&gt; B</tt></span><span class="pyret-highlight"><tt class="pyretexpr">)</tt></span>.  It takes in the contents of a cell, as well as the coordinates (column name, as given by the <a href="builtin/tables.html#s:tables:loading"><span class="pyret-highlight"><tt class="pyretexpr">load-table</tt></span>   header</a>, and zero-indexed row number) of that cell, and attempts to parse the contents of that cell to a value of the intended Pyret type.  If a cell’s contents cannot be parsed, the sanitizer may raise an error explaining the problem.</p></div><h3 id="Pre-defined-sanitizers" toclevel="3" tocentry="yes">Pre-defined sanitizers</h3><div><p><span><a name="string-sanitizer"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#string-sanitizer">string-sanitizer</a> :: <span>(<span><span class="pyret-content">x :: <span><a href="../trove/data-source.html#CellContent">CellContent</a>&lt;<span>A</span>&gt;</span></span>, <span class="pyret-content">col :: <a href="../trove/globals.html#String">String</a></span>, <span class="pyret-content">row :: <a href="../trove/globals.html#Number">Number</a></span></span>) -&gt; <a href="../trove/globals.html#String">String</a></span></pre></div><p>This sanitizer tries to convert <a href="../trove/data-source.html#CellContent"><span class="pyret-highlight"><tt class="pyretexpr">CellContent</tt></span></a>s containing anything to a <a href="UnDeFiNeD"></a>, by calling <a href="UnDeFiNeD"></a> on it.</p><div><p><span><a name="num-sanitizer"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#num-sanitizer">num-sanitizer</a> :: <span>(<span><span class="pyret-content">x :: <span><a href="../trove/data-source.html#CellContent">CellContent</a>&lt;<span>A</span>&gt;</span></span>, <span class="pyret-content">col :: <a href="../trove/globals.html#String">String</a></span>, <span class="pyret-content">row :: <a href="../trove/globals.html#Number">Number</a></span></span>) -&gt; <a href="../trove/globals.html#String">String</a></span></pre></div><p>This sanitizer tries to convert <a href="../trove/data-source.html#CellContent"><span class="pyret-highlight"><tt class="pyretexpr">CellContent</tt></span></a>s containing numbers, strings, or booleans to a <a href="UnDeFiNeD"></a>.  Strings are attempted to be parsed. True and false convert to 1 and 0 respectively.  Any other values are rejected, including blank cells.</p><div><p><span><a name="bool-sanitizer"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#bool-sanitizer">bool-sanitizer</a> :: <span>(<span><span class="pyret-content">x :: <span><a href="../trove/data-source.html#CellContent">CellContent</a>&lt;<span>A</span>&gt;</span></span>, <span class="pyret-content">col :: <a href="../trove/globals.html#String">String</a></span>, <span class="pyret-content">row :: <a href="../trove/globals.html#Number">Number</a></span></span>) -&gt; <a href="../trove/globals.html#String">String</a></span></pre></div><p>This sanitizer tries to convert <a href="../trove/data-source.html#CellContent"><span class="pyret-highlight"><tt class="pyretexpr">CellContent</tt></span></a>s containing numbers, strings, or booleans to a <a href="UnDeFiNeD"></a>.  0 and 1 convert to <span class="pyret-highlight"><tt class="pyretexpr">false</tt></span> and <span class="pyret-highlight"><tt class="pyretexpr">true</tt></span> respectively.  The (case-insensitive) strings <span class="pyret-highlight"><tt class="pyretexpr">“true”</tt></span> and <span class="pyret-highlight"><tt class="pyretexpr">“false”</tt></span> convert appropriately.  Any other values are rejected, including blank cells.</p><div><p><span><a name="strict-num-sanitizer"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#strict-num-sanitizer">strict-num-sanitizer</a> :: <span>(<span><span class="pyret-content">x :: <span><a href="../trove/data-source.html#CellContent">CellContent</a>&lt;<span>A</span>&gt;</span></span>, <span class="pyret-content">col :: <a href="../trove/globals.html#String">String</a></span>, <span class="pyret-content">row :: <a href="../trove/globals.html#Number">Number</a></span></span>) -&gt; <a href="../trove/globals.html#String">String</a></span></pre></div><p>This sanitizer tries to convert <a href="../trove/data-source.html#CellContent"><span class="pyret-highlight"><tt class="pyretexpr">CellContent</tt></span></a>s containing strings or numbers to a <a href="UnDeFiNeD"></a>.  Strings are attempted to be parsed.  Any other values are rejected, including blank cells.</p><div><p><span><a name="strings-only"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#strings-only">strings-only</a> :: <span>(<span><span class="pyret-content">x :: <span><a href="../trove/data-source.html#CellContent">CellContent</a>&lt;<span>A</span>&gt;</span></span>, <span class="pyret-content">col :: <a href="../trove/globals.html#String">String</a></span>, <span class="pyret-content">row :: <a href="../trove/globals.html#Number">Number</a></span></span>) -&gt; <a href="../trove/globals.html#String">String</a></span></pre></div><p>This sanitizer accepts <a href="../trove/data-source.html#CellContent"><span class="pyret-highlight"><tt class="pyretexpr">CellContent</tt></span></a>s containing strings only, and rejects all other values, including blank cells.</p><div><p><span><a name="booleans-only"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#booleans-only">booleans-only</a> :: <span>(<span><span class="pyret-content">x :: <span><a href="../trove/data-source.html#CellContent">CellContent</a>&lt;<span>A</span>&gt;</span></span>, <span class="pyret-content">col :: <a href="../trove/globals.html#String">String</a></span>, <span class="pyret-content">row :: <a href="../trove/globals.html#Number">Number</a></span></span>) -&gt; <a href="../trove/globals.html#String">String</a></span></pre></div><p>This sanitizer accepts <a href="../trove/data-source.html#CellContent"><span class="pyret-highlight"><tt class="pyretexpr">CellContent</tt></span></a>s containing booleans only, and rejects all other values, including blank cells.</p><div><p><span><a name="numbers-only"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#numbers-only">numbers-only</a> :: <span>(<span><span class="pyret-content">x :: <span><a href="../trove/data-source.html#CellContent">CellContent</a>&lt;<span>A</span>&gt;</span></span>, <span class="pyret-content">col :: <a href="../trove/globals.html#String">String</a></span>, <span class="pyret-content">row :: <a href="../trove/globals.html#Number">Number</a></span></span>) -&gt; <a href="../trove/globals.html#String">String</a></span></pre></div><p>This sanitizer accepts <a href="../trove/data-source.html#CellContent"><span class="pyret-highlight"><tt class="pyretexpr">CellContent</tt></span></a>s containing numbers only, and rejects all other values, including blank cells.</p><div><p><span><a name="empty-only"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#empty-only">empty-only</a> :: <span>(<span><span class="pyret-content">x :: <span><a href="../trove/data-source.html#CellContent">CellContent</a>&lt;<span>A</span>&gt;</span></span>, <span class="pyret-content">col :: <a href="../trove/globals.html#String">String</a></span>, <span class="pyret-content">row :: <a href="../trove/globals.html#Number">Number</a></span></span>) -&gt; <a href="../trove/globals.html#String">String</a></span></pre></div><p>This sanitizer accepts <a href="../trove/data-source.html#CellContent"><span class="pyret-highlight"><tt class="pyretexpr">CellContent</tt></span></a>s containing blank cells only, and rejects all other values.</p><div><p><span><a name="option-sanitizer"></a></span></p><pre class="pyret-display"><a href="../trove/data-source.html#option-sanitizer">option-sanitizer</a> :: <span>(<span><span><a href="../trove/data-source.html#Sanitizer">Sanitizer</a>&lt;<span>A</span>&gt;</span></span>) -&gt; <span><a href="../trove/data-source.html#Sanitizer">Sanitizer</a>&lt;<span><span><a href="../trove/option.html#Option">Option</a>&lt;<span>A</span>&gt;</span></span>&gt;</span></span></pre></div><p>This higher-order sanitizer takes in another sanitizer that does not expect to be given blank cells, and produces a new sanitizer that can accept them.  Blank cells are converted to <a href="../trove/option.html#none"><span class="pyret-highlight"><tt class="pyretexpr">none</tt></span></a>, while valid non-blank cells are converted to a <a href="../trove/option.html#some"><span class="pyret-highlight"><tt class="pyretexpr">some</tt></span></a> value containing the converted contents of the cell.  Values rejected by the <span class="pyret-highlight"><tt class="pyretexpr">value-sanitizer</tt></span> are rejected by this sanitizer as well.</p><p>This sanitizer is useful for handling incomplete data that might contain blank values; a subsequent processing step could filter out the <a href="../trove/option.html#none"><span class="pyret-highlight"><tt class="pyretexpr">none</tt></span></a> values.</p></div></root>
    <hr/>
    The current page is trove/data-source.html.
    The previous page is <a href = "../builtin/raw-arrays.html">../builtin/raw-arrays.html</a>.
    The next page is <a href = "../trove/srcloc.html">../trove/srcloc.html</a>.
    </div>
  </body>
</html>