<!doctype html>
<html lang="en">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
  <style>
     li.indent2 {
       text-indent: 2em;
     }
     ul.toclist {
       list-style-type: none;
     }
     .pyretexpr {
       color: cornflowerblue;
     }
     .function {
       font-family: monospace;
       background-color: #6bccdf;
     }
  </style>
  <head>
    <title>FFI Helpers</title>
  </head>
  <body>
    <div class="container">
    <root><h1 id="ffi" toclevel="1" tocentry="yes">FFI Helpers</h1><p>There are a number of convenience functions that aren’t native to the Pyret runtime, but are often used in JavaScript code that interacts with the runtime. Some of the most commonly used ones are documented here; this list is often growing.</p><h2 id="ffi:equality" toclevel="2" tocentry="yes">Equality</h2><p>The ffi exposes several utilities related to <a href="UnDeFiNeD">UnDeFiNeD</a>.</p><pre>FFI.equal :: PyretObject</pre><p>The <tt class="pyretexpr">Equalequality</tt> value.</p><pre>FFI.unknown :: PyretObject</pre><p>The <tt class="pyretexpr">Unknownequality</tt> value.</p><pre>FFI.notEqual :: PyretFunction</pre><p>The <tt class="pyretexpr">NotEqualequality</tt> constructor.</p><pre>FFI.isEqual(Any) → JSBoolean</pre><p>Checks if the given value is <tt class="pyretexpr">Equalequality</tt>.</p><pre>FFI.isNotEqual(Any) → JSBoolean</pre><p>Checks if the given value is an instance of <tt class="pyretexpr">NotEqualequality</tt>.</p><pre>FFI.isUnknown(Any) → JSBoolean</pre><p>Checks if the given value is a <tt class="pyretexpr">Unknownequality</tt>.</p><pre>FFI.isEqualityResult(Any) → JSBoolean</pre><p>Checks if the given value is an instance of a <tt class="pyretexpr">EqualityResultequality</tt>.</p><h2 id="ffi:exceptions" toclevel="2" tocentry="yes">Exceptions</h2><p>FFI helpers provide the easiest way to programmatically throw Pyret exceptions from JavaScript.  Most commonly, user-defined modules will simply throw <tt class="pyretexpr">MessageExceptions</tt> that contain a string describing the error.</p><pre>FFI.throwMessageException(PyretString) → Undefined</pre><p>Throws an exception that Pyret recognizes and reports with a stack trace, using the provided string as the message.</p><pre>FFI.makeMessageException(PyretString) → Error</pre><p>Sometimes its useful to <emph>create</emph> an exception without actually throwing it, like when using the <tt class="pyretexpr">error</tt> callback of the <tt class="pyretexpr">Restarter</tt> in <internal-id>RuntimepauseStack</internal-id>.  This call creates a new exception object without throwing it.</p><h2 id="ffi:lists" toclevel="2" tocentry="yes">Lists</h2><p>Pyret lists are ubiquitous in Pyret’s internals and libraries, and this library provides a few conveniences for working with them.</p><pre>FFI.makeList(JSArray) → List</pre><p>Turns a JavaScript array into a Pyret <tt class="pyretexpr">Listlists</tt> with the same elements in the same order.</p><pre>FFI.toArray(List) → JSArray</pre><p>Turns a Pyret <tt class="pyretexpr">Listlists</tt> with the same elements in the same order.  For doing computationally heavy work, sometimes it is useful to convert a Pyret <tt class="pyretexpr">List</tt> to an array before processing it (and using JavaScript’s map/filter, etc.), since the Pyret version incurs more overhead.</p><pre>FFI.isList(Any) → JSBoolean</pre><p>Returns <tt class="pyretexpr">true</tt> if the value is a Pyret <tt class="pyretexpr">Listlists</tt> and <tt class="pyretexpr">false</tt> otherwise.</p><h2 id="Other-Data-Helpers" toclevel="2" tocentry="yes">Other Data Helpers</h2><pre>FFI.makeSome(Any) → Option</pre><pre>FFI.makeNone(Any) → Option</pre><p>Create instances of <tt class="pyretexpr">noneoption</tt> and <tt class="pyretexpr">someoption</tt> from <a href="UnDeFiNeD">UnDeFiNeD</a>.</p><pre>FFI.makeLeft(Any) → Either</pre><pre>FFI.makeRight(Any) → Either</pre><p>Create instances of <tt class="pyretexpr">lefteither</tt> and <tt class="pyretexpr">righteither</tt> from <a href="UnDeFiNeD">UnDeFiNeD</a>.</p><pre>FFI.cases(
  (Any -&gt; JSBoolean)
  JSString
  Any
  Handlers
)
→ Any</pre><p>This call emulates the functionality of the <tt class="pyretexpr">cases</tt> expression in a JavaScript context.  It takes a predicate to check (usually a function like <tt class="pyretexpr">is-List</tt>), a name for the predicate being checked, a <tt class="pyretexpr">data</tt> value, and an object containing handlers for its variants.  For example:</p><pre>function sum(l) {
  cases(runtime.getField(lists, "is-List"), "List", l, {
    empty: function() { return "Empty"; },
    link: function(f, r) { return f + sum(r); }
  });
}
sum(runtime.ffi.makeList([1,2])) // is 3</pre><p>The predicate check and name are solely for error reporting.</p></root>
    <hr/>
    The current page is internals/ffi-helpers.html.
    The previous page is <a href = "../internals/runtime.html">../internals/runtime.html</a>.
    The next page is <a href = "../internals/running.html">../internals/running.html</a>.
    </div>
  </body>
</html>