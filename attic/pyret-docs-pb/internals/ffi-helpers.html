<!doctype html>
<html lang="en">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
  <script type="module" src="../embed-api.js"></script>
  <script src="../codemirror.js"></script>
  <script src="../runmode.js"></script>
  <script src="../pyret.js"></script>
  <script src="../hilite.js"></script>
  <link rel="stylesheet" type="text/css" href="../codemirror.css" title="default"/>
  <link rel="stylesheet" type="text/css" href="../pyret.css" title="default"/>
  <link rel="stylesheet" type="text/css" href="../styles.css" title="default"/>
  <head>
    <title>FFI Helpers</title>
  </head>
  <body>
    <div class="container">
    <root><h1 id="ffi" toclevel="1" tocentry="yes">FFI Helpers</h1><p>There are a number of convenience functions that aren’t native to the Pyret runtime, but are often used in JavaScript code that interacts with the runtime. Some of the most commonly used ones are documented here; this list is often growing.</p><h2 id="ffi:equality" toclevel="2" tocentry="yes">Equality</h2><p>The ffi exposes several utilities related to <a href="../lang/equality.html#equality">equality</a>.</p><div><pre class="pyret-display">FFI.equal :: PyretObject</pre></div><p>The <a href="../missing_gloss"><span class="pyret-highlight"><tt class="pyretexpr">Equal</tt></span></a> value.</p><div><pre class="pyret-display">FFI.unknown :: PyretObject</pre></div><p>The <a href="../missing_gloss"><span class="pyret-highlight"><tt class="pyretexpr">Unknown</tt></span></a> value.</p><div><pre class="pyret-display">FFI.notEqual :: PyretFunction</pre></div><p>The <a href="../missing_gloss"><span class="pyret-highlight"><tt class="pyretexpr">NotEqual</tt></span></a> constructor.</p><div><pre class="pyret-display">FFI.isEqual(Any) → JSBoolean</pre></div><p>Checks if the given value is <a href="../missing_gloss"><span class="pyret-highlight"><tt class="pyretexpr">Equal</tt></span></a>.</p><div><pre class="pyret-display">FFI.isNotEqual(Any) → JSBoolean</pre></div><p>Checks if the given value is an instance of <a href="../missing_gloss"><span class="pyret-highlight"><tt class="pyretexpr">NotEqual</tt></span></a>.</p><div><pre class="pyret-display">FFI.isUnknown(Any) → JSBoolean</pre></div><p>Checks if the given value is a <a href="../missing_gloss"><span class="pyret-highlight"><tt class="pyretexpr">Unknown</tt></span></a>.</p><div><pre class="pyret-display">FFI.isEqualityResult(Any) → JSBoolean</pre></div><p>Checks if the given value is an instance of a <a href="../lang/equality.html#EqualityResult"><span class="pyret-highlight"><tt class="pyretexpr">EqualityResult</tt></span></a>.</p><h2 id="ffi:exceptions" toclevel="2" tocentry="yes">Exceptions</h2><p>FFI helpers provide the easiest way to programmatically throw Pyret exceptions from JavaScript.  Most commonly, user-defined modules will simply throw <tt>MessageExceptions</tt> that contain a string describing the error.</p><div><pre class="pyret-display">FFI.throwMessageException(PyretString) → Undefined</pre></div><p>Throws an exception that Pyret recognizes and reports with a stack trace, using the provided string as the message.</p><div><pre class="pyret-display">FFI.makeMessageException(PyretString) → Error</pre></div><p>Sometimes its useful to <i>create</i> an exception without actually throwing it, like when using the <tt>error</tt> callback of the <tt>Restarter</tt> in <internal-id>RuntimepauseStack</internal-id>.  This call creates a new exception object without throwing it.</p><h2 id="ffi:lists" toclevel="2" tocentry="yes">Lists</h2><p>Pyret lists are ubiquitous in Pyret’s internals and libraries, and this library provides a few conveniences for working with them.</p><div><pre class="pyret-display">FFI.makeList(JSArray) → List</pre></div><p>Turns a JavaScript array into a Pyret <a href="../trove/lists.html#List"><span class="pyret-highlight"><tt class="pyretexpr">List</tt></span></a> with the same elements in the same order.</p><div><pre class="pyret-display">FFI.toArray(List) → JSArray</pre></div><p>Turns a Pyret <a href="../trove/lists.html#List"><span class="pyret-highlight"><tt class="pyretexpr">List</tt></span></a> with the same elements in the same order.  For doing computationally heavy work, sometimes it is useful to convert a Pyret <tt>List</tt> to an array before processing it (and using JavaScript’s map/filter, etc.), since the Pyret version incurs more overhead.</p><div><pre class="pyret-display">FFI.isList(Any) → JSBoolean</pre></div><p>Returns <tt>true</tt> if the value is a Pyret <a href="../trove/lists.html#List"><span class="pyret-highlight"><tt class="pyretexpr">List</tt></span></a> and <tt>false</tt> otherwise.</p><h2 id="Other-Data-Helpers" toclevel="2" tocentry="yes">Other Data Helpers</h2><div><pre class="pyret-display">FFI.makeSome(Any) → Option</pre></div><div><pre class="pyret-display">FFI.makeNone(Any) → Option</pre></div><p>Create instances of <a href="../trove/option.html#none"><span class="pyret-highlight"><tt class="pyretexpr">none</tt></span></a> and <a href="../trove/option.html#some"><span class="pyret-highlight"><tt class="pyretexpr">some</tt></span></a> from <a href="../trove/option.html#option">option</a>.</p><div><pre class="pyret-display">FFI.makeLeft(Any) → Either</pre></div><div><pre class="pyret-display">FFI.makeRight(Any) → Either</pre></div><p>Create instances of <a href="../trove/either.html#left"><span class="pyret-highlight"><tt class="pyretexpr">left</tt></span></a> and <a href="../trove/either.html#right"><span class="pyret-highlight"><tt class="pyretexpr">right</tt></span></a> from <a href="../trove/either.html#either">either</a>.</p><div><pre class="pyret-display">FFI.cases(
  (Any -&gt; JSBoolean)
  JSString
  Any
  Handlers
)
→ Any</pre></div><p>This call emulates the functionality of the <tt>cases</tt> expression in a JavaScript context.  It takes a predicate to check (usually a function like <tt>is-List</tt>), a name for the predicate being checked, a <tt>data</tt> value, and an object containing handlers for its variants.  For example:</p><pre class="nothing_special">function sum(l) {
  cases(runtime.getField(lists, "is-List"), "List", l, {
    empty: function() { return "Empty"; },
    link: function(f, r) { return f + sum(r); }
  });
}
sum(runtime.ffi.makeList([1,2])) // is 3</pre><p>The predicate check and name are solely for error reporting.</p></root>
    <hr/>
    <!-- The current page is internals/ffi-helpers.html. -->
    <a class="floatleft" href="../internals/runtime.html">⏴⏴⏴</a>
    <a class="floatright" href="../internals/running.html">⏵⏵⏵</a>
    </div>
  </body>
</html>