<!doctype html>
<html lang="en">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
  <script type="module" src="../embed-api.js"></script>
  <script src="../codemirror.js"></script>
  <script src="../runmode.js"></script>
  <script src="../pyret.js"></script>
  <script src="../hilite.js"></script>
  <link rel="stylesheet" type="text/css" href="../codemirror.css" title="default"/>
  <link rel="stylesheet" type="text/css" href="../pyret.css" title="default"/>
  <link rel="stylesheet" type="text/css" href="../styles.css" title="default"/>
  <head>
    <title>Type Checking</title>
  </head>
  <body>
    <div class="container">
    <root><div><h1 id="type-check" toclevel="1" tocentry="yes">Type Checking</h1><p><span></span> Pyret has an optional static type checker. On <url>https://code.pyret.org</url> it can be accessed as a drop down option under the Run button, and from the command line it can be run by adding the flag <tt>-type-check</tt>.</p><p>The type checker is built around the <a href="../lang/forms.html#s:annotations">annotation</a> system, providing a static check that all annotations are correct and that all uses of annotated functions have the proper types passed to them.</p><h2 id="required-annotations" toclevel="2" tocentry="yes">Required Annotations</h2><p>When using the type checker annotations are required in two locations. Everywhere else they are optional (barring certain caveats). The first of the required locations is the arguments of top level functions.</p><p>The function <span class="pyret-highlight"><tt class="pyretexpr">foo</tt></span> type checks as an annotation is provided on the argument <span class="pyret-highlight"><tt class="pyretexpr">x</tt></span>. The return annotation is not necessary so the function <span class="pyret-highlight"><tt class="pyretexpr">bar</tt></span> also type checks. However, the function <span class="pyret-highlight"><tt class="pyretexpr">baz</tt></span> will fail to type check with an error requiring an annotation on the argument <span class="pyret-highlight"><tt class="pyretexpr">x</tt></span>.</p><pre class="pyret-highlight"># Type checks
fun foo(x :: Number) -&gt; Number:
  x
end

# Type checks
fun bar(x :: Number):
  x
end

# Fails
fun baz(x):
  x
end</pre><p>The other place that annotations are required is on <a href="../lang/forms.html#s:data-decl">data declarations</a>. Each field must be annotated with its type.</p><pre class="pyret-highlight"># Type checks
data BTree:
  | node(value :: Number, left :: BTree, right :: BTree)
  | leaf(value :: Number)
end</pre><h2 id="working-with-data-types" toclevel="2" tocentry="yes">Working with Data Types</h2><p>There are a couple important notes when working with polymorphic data types such as <span class="pyret-highlight"><tt class="pyretexpr">Option</tt></span> (defined below).</p><pre class="pyret-highlight">data Option&lt;A&gt;:
  | none
  | some(value :: A)
end</pre><p>Whenever a value is being annotated with a polymorphic type, the type instantiation must be written. So <span class="pyret-highlight"><tt class="pyretexpr">x :: Option&lt;Number&gt; = some(1)</tt></span> is okay, but <span class="pyret-highlight"><tt class="pyretexpr">x :: Option = some(1)</tt></span> is not. The caveat to this is when writing <span class="pyret-highlight"><tt class="pyretexpr">cases</tt></span> statements. On these the instantiating type is not needed and you can simply write <span class="pyret-highlight"><tt class="pyretexpr">cases(Option) x:</tt></span>.</p><h2 id="record-types" toclevel="2" tocentry="yes">Record Types</h2><p>Record types such as <span class="pyret-highlight"><tt class="pyretexpr">{x :: Number, y :: String}</tt></span> have two meanings. The first one is that they are the type of records (<span class="pyret-highlight"><tt class="pyretexpr">{x: 1, y: “a”}</tt></span> has the type shown above). In addition, any data type where all variants have the fields <span class="pyret-highlight"><tt class="pyretexpr">x :: Number</tt></span> and <span class="pyret-highlight"><tt class="pyretexpr">y :: String</tt></span> would satisfy that type. For example, if we have the code shown below, the type checker will accept the program.</p><pre class="pyret-highlight">data Side:
  | left(x :: Number)
  | right(x :: Number)
end

fun f(thing :: {x :: Number}) -&gt; Number:
  thing.x
end

side-thing :: Side = left(1)
x :: Number = f(side-thing) # Type checks</pre></div></root>
    <hr/>
    <!-- The current page is lang/type-check.html. -->
    <a class="floatleft" href="../lang/brands.html">⏴⏴⏴</a>
    <a class="floatright" href="../lang/spies.html">⏵⏵⏵</a>
    </div>
  </body>
</html>